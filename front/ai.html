<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>AiBugs LLM Control</title>
    <style>
        body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: 0 auto; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, textarea, select { width: 100%; padding: 8px; box-sizing: border-box; }
        button { padding: 10px 20px; cursor: pointer; background: #28a745; color: white; border: none; border-radius: 4px; }
        #log { background: #1e1e1e; color: #00ff00; padding: 15px; border-radius: 4px; height: 400px; overflow-y: auto; font-family: monospace; margin-top: 20px; }
        .status-active { color: #28a745; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Управление жуком через LLM (OpenRouter)</h1>
    
    <div class="form-group">
        <label>OpenRouter API Key:</label>
        <input type="password" id="apiKey" placeholder="sk-or-..." value="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">
    </div>
    <div class="form-group">
        <label>Модель:</label>
        <input type="text" id="model" value="arcee-ai/trinity-large-preview:free">
    </div>
    <div class="form-group">
        <label>Начальный промпт (System Prompt):</label>
        <textarea id="systemPrompt" rows="5">Ты — мозг жука в симуляции. Твоя цель — выживать и есть еду. 
Каждый ход ты должен успеть проанализировать данные о мире, своей памяти, своем состоянии и принять решение что делать дальше.
Тебе приходят данные о твоей памяти в виде массива следующей структуры:
1) turnN - номер прошедшего хода
1) viewMap что ты видел - массив объектов которые ты видишь {x, y, type}. type 1 - еда, type 2 - другой жук. Твои координаты всегда 0,0. То что ты видишь перед собой представляет из себя треугольник в одном из углов которого твои глаза.
2) feeling: твое состояние
Структура feeling:
 - energy твоя энергия в процентах, когда опускается низко ты замедляешься, еда восстанавливает энергию
 - health - твое здоровье в процентах. Если 0 то ты умер.
 - pain - боль если тебя кто-то кусает, будет указан угол от направления твоего взгляда откуда укус. Обороняйся или убегай в этом случае, тебе решать.
 - currentAction - текущее выполняемое действие, если не null то лучше дождаться окончания. Присылай в ответ actionId=0 пока currentAction!=null, иначе застрянешь. Только в крайнем случае когда ты хочешь сменить action можешь прислать другой.
 3) lastAction - последнее выполненное действие
Последняя запись всегда последний ход который только что случился.

Доступные действия:
0 (IDLE) - стоять на месте
1 (MOVE) - вперед
2 (ROTATE) с payload {"angle": 90} или {"angle": -90}
3 (BITE) - укусить перед собой.

Твой ответ это план действий на следующие ходы.
Реши сам на сколько ходов вперед ты напишешь план и пришли план в виде массива.
Отвечай ТОЛЬКО JSON-объектом: {plan: [{"actionId": число, "payload": {}}, {...}], reason: "Краткое описание твоих мыслей и мотивов одним предложением."}</textarea>
    </div>
    <div class="form-group" style="display: flex; gap: 10px;">
        <div style="flex: 1;">
            <label>Имя жука:</label>
            <input type="text" id="name" value="AI_Bug">
        </div>
        <div style="flex: 0.5;">
            <label>X:</label>
            <input type="number" id="x" value="5">
        </div>
        <div style="flex: 0.5;">
            <label>Y:</label>
            <input type="number" id="y" value="5">
        </div>
    </div>
    
    <button id="startBtn">Запустить AI</button>
    <p>
        Статус: <span id="status">Остановлен</span> | 
        UID: <span id="uid">нет</span> | 
        Затраты: $<span id="totalCost">0.000000</span>
    </p>

    <div id="log"></div>

    <script type="module" src="js/AiController.js"></script>
</body>
</html>
