<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Bug Farm</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f4f4f9; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .bug-card { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 10px; display: grid; grid-template-columns: 1fr 1fr 2fr 2fr 1fr 1fr; gap: 15px; align-items: center; }
        .bar-container { background: #eee; height: 20px; border-radius: 10px; overflow: hidden; position: relative; }
        .bar { height: 100%; transition: width 0.3s; }
        .health-bar { background: #28a745; }
        .energy-bar { background: #007bff; }
        .bar-text { position: absolute; width: 100%; text-align: center; font-size: 12px; line-height: 20px; color: #000; font-weight: bold; }
        table { border-collapse: collapse; table-layout: fixed; }
        td { width: 20px; height: 20px; border: 1px solid #eee; text-align: center; font-size: 10px; padding: 0; overflow: hidden; }
        button { padding: 8px 12px; cursor: pointer; border: none; border-radius: 4px; }
        .btn-add { background: #28a745; color: white; font-size: 16px; }
        .btn-log { background: #17a2b8; color: white; }
        .btn-del { background: #dc3545; color: white; }
        
        /* Modal */
        .modal { display: none; position: fixed; z-index: 1; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); }
        .modal-content { background: white; margin: 5% auto; padding: 20px; width: 80%; max-height: 80%; overflow-y: auto; border-radius: 8px; }
        #logContent { background: #1e1e1e; color: #00ff00; padding: 15px; font-family: monospace; white-space: pre-wrap; }
        #experienceContent { background: #fff3cd; color: #856404; padding: 15px; border-radius: 4px; margin-bottom: 10px; border: 1px solid #ffeeba; font-style: italic; }
        
        .form-container { background: #fff; padding: 20px; border-radius: 8px; margin-bottom: 20px; display: none; border: 1px solid #ddd; }
        .form-group { margin-bottom: 10px; }
        input, textarea { width: 100%; padding: 8px; box-sizing: border-box; }
    </style>
</head>
<body>
    <div class="header">
        <h1>–ñ—É—á–∏–Ω–∞—è —Ñ–µ—Ä–º–∞</h1>
        <button class="btn-add" onclick="document.getElementById('addForm').style.display='block'">+ –î–æ–±–∞–≤–∏—Ç—å –∂—É–∫–∞</button>
    </div>

    <div id="addForm" class="form-container">
        <h3>–ù–æ–≤—ã–π –ø–æ–¥–æ–ø—ã—Ç–Ω—ã–π</h3>
        <div class="form-group"><input type="password" id="apiKey" placeholder="OpenRouter API Key" value="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"></div>
        <div class="form-group"><input type="text" id="model" value="arcee-ai/trinity-large-preview:free"></div>
        <div class="form-group"><textarea id="systemPrompt" rows="3">–¢—ã ‚Äî –º–æ–∑–≥ –∂—É–∫–∞ –≤ —Å–∏–º—É–ª—è—Ü–∏–∏. –¢–≤–æ—è —Ü–µ–ª—å ‚Äî –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –º–∏—Ä, —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –æ–ø—ã—Ç –∏ –≤—ã–∂–∏–≤–∞—Ç—å.
–¢—ã –¥–æ–ª–∂–µ–Ω –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –º–∏—Ä–µ, —Å–≤–æ–µ–π –ø–∞–º—è—Ç–∏ (–ø—Ä–æ–∏–∑–æ—à–µ–¥—à–∏—Ö —Å–æ–±—ã—Ç–∏—è—Ö), —Å–≤–æ–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏, –¥–µ–ª–∞—Ç—å –≤—ã–≤–æ–¥—ã –∏ —Å–æ—Å—Ç–∞–≤–ª—è—Ç—å –ø–ª–∞–Ω –¥–∞–ª—å–Ω–µ–π—à–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π.
–î–∞–Ω–Ω—ã–µ –æ –ø–∞–º—è—Ç–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç –º–∞—Å—Å–∏–≤–æ–º —Å–æ —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π:
1) turnN - –Ω–æ–º–µ—Ä —Ö–æ–¥–∞
1) viewMap —á—Ç–æ —Ç—ã –≤–∏–¥–µ–ª –≤ —ç—Ç–æ—Ç —Ö–æ–¥ - –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ –Ω–∞ –≤–∏–¥–∏–º–æ–º –¥–ª—è —Ç–µ–±—è –ø–æ–ª–µ {x, y, type}. type 1 - –µ–¥–∞, type 2 - –¥—Ä—É–≥–æ–π –∂—É–∫. –¢–≤–æ–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤—Å–µ–≥–¥–∞ 0,0. –¢–æ —á—Ç–æ –ø–µ—Ä–µ–¥ —Ç–æ–±–æ–π –∏ –º–æ–∂–Ω–æ –∫—É—Å–∞—Ç—å –∏–º–µ–µ—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã 0,1. –ù–∞ 45 –≥—Ä–∞–¥—É—Å–æ–≤ –≤–ª–µ–≤–æ - -1,1, –ù–∞ 45 –≥—Ä–∞–¥—É—Å–æ–≤ –≤–ø—Ä–∞–≤–æ - 1,1
2) feeling: –æ–±—ä–µ–∫—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–ª–µ–¥—É—é—â–µ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
 - energy —Ç–≤–æ—è —ç–Ω–µ—Ä–≥–∏—è –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö, –µ–¥–∞ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —ç–Ω–µ—Ä–≥–∏—é
 - health - —Ç–≤–æ–µ –∑–¥–æ—Ä–æ–≤—å–µ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö. –ï—Å–ª–∏ 0 —Ç–æ —Ç—ã —É–º–µ—Ä.
 - pain - –±–æ–ª—å –µ—Å–ª–∏ —Ç–µ–±—è –∫—Ç–æ-—Ç–æ –∫—É—Å–∞–µ—Ç, –±—É–¥–µ—Ç —É–∫–∞–∑–∞–Ω —É–≥–æ–ª –æ—Ç –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–≤–æ–µ–≥–æ –≤–∑–≥–ª—è–¥–∞ –æ—Ç–∫—É–¥–∞ —É–∫—É—Å.
 - currentPlan - —Ç–µ–∫—É—â–∏–π –≤—ã–ø–æ–ª–Ω—è–µ–º—ã–π –ø–ª–∞–Ω, –µ—Å–ª–∏ –Ω–µ –ø—É—Å—Ç–æ–π —Ç–æ –ª—É—á—à–µ –¥–æ–∂–¥–∞—Ç—å—Å—è –æ–∫–æ–Ω—á–∞–Ω–∏—è. –ü—Ä–∏—Å—ã–ª–∞–π –≤ –æ—Ç–≤–µ—Ç actionId=0 –ø–æ–∫–∞ currentPlan –Ω–µ –ø—É—Å—Ç–æ–π, –∏–Ω–∞—á–µ –∑–∞—Å—Ç—Ä—è–Ω–µ—à—å. –¢–æ–ª—å–∫–æ –≤ –∫—Ä–∞–π–Ω–µ–º —Å–ª—É—á–∞–µ –∫–æ–≥–¥–∞ —Ç—ã —Ö–æ—á–µ—à—å —Å–º–µ–Ω–∏—Ç—å action –º–æ–∂–µ—à—å –ø—Ä–∏—Å–ª–∞—Ç—å –¥—Ä—É–≥–æ–π.
 3) lastAction - –ø–æ—Å–ª–µ–¥–Ω–µ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ
–ü–æ—Å–ª–µ–¥–Ω—è—è –∑–∞–ø–∏—Å—å –≤—Å–µ–≥–¥–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ö–æ–¥ –∫–æ—Ç–æ—Ä—ã–π —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–ª—É—á–∏–ª—Å—è.

–î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è:
0 (IDLE) - —Å—Ç–æ—è—Ç—å –Ω–∞ –º–µ—Å—Ç–µ
1 (MOVE) - –≤–ø–µ—Ä–µ–¥
2 (ROTATE) —Å payload {"angle": 90} –∏–ª–∏ {"angle": -90}
3 (BITE) - —É–∫—É—Å–∏—Ç—å –ø–µ—Ä–µ–¥ —Å–æ–±–æ–π.

–¢–≤–æ–π –æ—Ç–≤–µ—Ç —Å–æ—Å—Ç–æ–∏—Ç –∏–∑:
- plan - –ø–ª–∞–Ω–∞ –¥–µ–π—Å—Ç–≤–∏–π –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ —á–∏—Å–ª–æ —Ö–æ–¥–æ–≤, —Å–∞–º —Ä–µ—à–∞–π –Ω–∞ —Å–∫–æ–ª—å–∫–æ –≥–ª—É–±–æ–∫–æ –ø–ª–∞–Ω–∏—Ä—É–µ—à—å
- experience –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω—ã–π –æ–ø—ã—Ç - –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π –∏ –∏—Å—Å–ª–µ–¥—É–π –º–∏—Ä –∏ –ø—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã, –¥–µ–ª–∞–π –≤—ã–≤–æ–¥—ã. –ö–æ–≥–¥–∞ —Ö–æ—á–µ—à—å –æ–±–Ω–æ–≤–∏—Ç—å –æ–ø—ã—Ç –ø—Ä–∏—à–ª–∏ –µ–≥–æ —Ç–µ–∫—Å—Ç–æ–º, —Å–æ—Ö—Ä–∞–Ω—è–π –ø—Ä–æ—à–ª—ã–π –æ–ø—ã—Ç –∏ –¥–æ–±–∞–≤–ª—è–π –∫ –Ω–µ–º—É –Ω–æ–≤—ã–π. –ò–∑–º–µ–Ω—è–π –ø—Ä–æ—à–ª—ã–π –æ–ø—ã—Ç –µ—Å–ª–∏ –Ω—É–∂–Ω–æ. –ï—Å–ª–∏ –Ω–æ–≤–æ–≥–æ –æ–ø—ã—Ç–∞ –Ω–µ—Ç –ø—Ä–∏—Å—ã–ª–∞–π null.
- reason –ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–≤–æ–∏—Ö –º—ã—Å–ª–µ–π –∏ –º–æ—Ç–∏–≤–æ–≤ –æ–¥–Ω–∏–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º.
- mood - utf-8 –∏–∫–æ–Ω–∫–∞ —Å —Ç–≤–æ–∏–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ–º

–û—Ç–≤–µ—á–∞–π –¢–û–õ–¨–ö–û JSON-–æ–±—ä–µ–∫—Ç–æ–º:
{
    plan: [{"actionId": —á–∏—Å–ª–æ, "payload": {}}, {...}],
    reason: "...",
    experience: "...",
    mood: "..."
}
        </textarea></div>
        <div style="display: flex; gap: 10px;" class="form-group">
            <input type="text" id="name" value="Farm_Bug">
            <input type="number" id="x" value="5">
            <input type="number" id="y" value="5">
        </div>
        <button class="btn-add" id="confirmAdd">–°–æ–∑–¥–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å AI</button>
        <button onclick="document.getElementById('addForm').style.display='none'">–û—Ç–º–µ–Ω–∞</button>
    </div>

    <div id="bugList"></div>

    <hr>
    <div id="worldStats" style="background: #e9ecef; padding: 10px; border-radius: 8px; margin-bottom: 10px; display: flex; gap: 20px; font-weight: bold;">
        <span>–•–æ–¥: <span id="statTurnN">-</span></span>
        <span>–í—Ä–µ–º—è —Ä–µ—à–µ–Ω–∏—è: <span id="statDecisionTime">-</span>s</span>
        <span>–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å: <span id="statActivity">-</span>%</span>
    </div>
    <h3>–ö–∞—Ä—Ç–∞ –º–∏—Ä–∞</h3>
    <div id="worldMapContainer" style="overflow: auto; max-height: 600px; border: 1px dashed #ccc; width: 100%; background: white;"></div>

    <div id="logModal" class="modal">
        <div class="modal-content">
            <span style="float:right; cursor:pointer; font-size:24px;" onclick="document.getElementById('logModal').style.display='none'">&times;</span>
            <h3>–û–ø—ã—Ç –∏ –∑–Ω–∞–Ω–∏—è</h3>
            <div id="experienceContent">–ü–æ–∫–∞ –Ω–µ—Ç –Ω–∞–∫–æ–ø–ª–µ–Ω–Ω–æ–≥–æ –æ–ø—ã—Ç–∞...</div>
            <h3>–ó—Ä–µ–Ω–∏–µ</h3>
            <div style="display: flex; align-items: flex-start; gap: 20px; margin-bottom: 20px;">
                <div style="font-size: 40px;">üëÅÔ∏è</div>
                <div id="bugViewGrid" style="background: #fff; border: 1px solid #ccc;"></div>
            </div>
            <h3>–õ–æ–≥ –¥–µ–π—Å—Ç–≤–∏–π</h3>
            <div id="logContent"></div>
        </div>
    </div>

    <script type="module" src="js/FarmController.js"></script>
</body>
</html>
